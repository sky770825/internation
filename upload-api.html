<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>🚀 真正的一鍵上傳 HTML 工具</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
<style>
  * { box-sizing: border-box; }
  
  :root{
    --font:'Microsoft JhengHei',system-ui,-apple-system,Segoe UI,Roboto,Noto Sans TC,Arial,sans-serif;
    --bg:#fff7ed; --card:#fff; --ink:#5b3a29; --sub:#7b5b4a;
    --brand:#ff7f50; --brand2:#ffb703; --muted:#fff0e0; --line:#f2d3b1;
    --shadow:0 8px 16px rgba(0,0,0,.08); --r:14px;
    --success:#16a34a; --danger:#dc2626; --info:#2563eb;
  }
  
  html,body{ margin:0; font-family:var(--font); background:var(--bg); color:var(--ink); }
  .wrap{ max-width:800px; margin:auto; padding:clamp(10px,3vw,18px); }
  
  .hero{
    background:linear-gradient(135deg,var(--muted),#fff); border:1px solid #ffd6ad; border-radius:var(--r);
    box-shadow:var(--shadow); padding:clamp(12px,3vw,20px); margin-bottom:20px; text-align:center;
  }
  .hero h1{ margin:0; font-size:clamp(20px,5.2vw,30px); display:flex; align-items:center; justify-content:center; gap:10px }
  .hero p{ margin:8px 0 0; color:var(--sub); font-size:clamp(14px,3.5vw,16px); }
  
  .card{
    background:#fff; border:1px solid var(--line); border-radius:var(--r); 
    box-shadow:var(--shadow); padding:20px; margin-bottom:20px;
  }
  
  .form-group{ margin-bottom:20px; }
  label{ display:block; font-weight:700; margin-bottom:8px; color:var(--ink); }
  
  input, select, textarea{
    width:100%; padding:12px; border:1px solid var(--line); border-radius:10px;
    font-size:16px; outline:0; transition:.2s; background:#fff;
  }
  input:focus, select:focus, textarea:focus{ border-color:var(--brand); box-shadow:0 0 0 3px rgba(255,127,80,.23) }
  
  .file-upload{
    border:2px dashed var(--line); background:var(--muted); text-align:center; padding:40px 20px;
    border-radius:var(--r); cursor:pointer; transition:.2s;
  }
  .file-upload:hover{ border-color:var(--brand); background:var(--muted); }
  .file-upload.dragover{ border-color:var(--brand); background:var(--muted); }
  .file-upload input{ display:none; }
  .file-upload .icon{ font-size:48px; color:var(--brand); margin-bottom:16px; }
  .file-upload .text{ color:var(--sub); font-size:16px; }
  .file-upload .selected{ color:var(--success); font-weight:600; }
  
  .btn{
    display:inline-flex; align-items:center; gap:8px; justify-content:center; font-weight:700;
    padding:12px 24px; border-radius:12px; border:0; cursor:pointer; color:#fff;
    background:linear-gradient(180deg,#ff9f68,var(--brand)); box-shadow:0 8px 14px rgba(255,127,80,.28);
    font-size:16px; text-decoration:none; transition:.2s;
  }
  .btn:hover{ transform:translateY(-1px); box-shadow:0 10px 20px rgba(255,127,80,.35); }
  .btn:disabled{ opacity:0.6; cursor:not-allowed; transform:none; }
  
  .btn-ghost{ background:linear-gradient(180deg,#ffd166,var(--brand2)); color:var(--ink); }
  .btn-ghost:hover{ background:#ffd166; }
  
  .result{
    background:var(--muted); border:1px solid var(--line); border-radius:var(--r);
    padding:20px; margin-top:20px; display:none;
  }
  .result.success{ background:#f0f9ff; border-color:var(--success); }
  .result.error{ background:#fef2f2; border-color:var(--danger); }
  .result.info{ background:#f0f9ff; border-color:var(--info); }
  
  .back-btn{
    display:inline-flex; align-items:center; gap:6px; padding:8px 12px;
    background:var(--brand2); color:var(--ink); border-radius:8px; text-decoration:none;
    font-size:14px; font-weight:600; margin-bottom:16px;
  }
  .back-btn:hover{ background:#ffd166; transform:translateY(-1px); }
  
  .loading{ display:none; text-align:center; padding:20px; }
  .spinner{ width:40px; height:40px; border:4px solid var(--muted); border-top:4px solid var(--brand); border-radius:50%; animation:spin 1s linear infinite; margin:0 auto 16px; }
  @keyframes spin{ 0%{ transform:rotate(0deg); } 100%{ transform:rotate(360deg); } }
  
  .steps{ display:grid; gap:16px; margin:20px 0; }
  .step{ 
    background:var(--muted); border:1px solid var(--line); border-radius:var(--r); 
    padding:16px; display:flex; align-items:center; gap:12px;
  }
  .step.completed{ background:#f0f9ff; border-color:var(--success); }
  .step-icon{ font-size:24px; }
  .step.completed .step-icon{ color:var(--success); }
  .step-number{ 
    width:32px; height:32px; border-radius:50%; background:var(--line); 
    display:flex; align-items:center; justify-content:center; font-weight:700; font-size:14px;
  }
  .step.completed .step-number{ background:var(--success); color:#fff; }
</style>
</head>
<body>
  <div class="wrap">
    <!-- 返回按鈕 -->
    <a href="index.html" class="back-btn">
      <i class="bi bi-arrow-left"></i> 返回工具集
    </a>

    <!-- 頁首 -->
    <section class="hero">
      <h1><i class="bi bi-cloud-upload"></i> 真正的一鍵上傳 HTML 工具</h1>
      <p>通過 GitHub API 直接上傳並部署您的 HTML 工具</p>
    </section>

    <!-- 上傳表單 -->
    <div class="card">
      <form id="uploadForm">
        <!-- 文件上傳 -->
        <div class="form-group">
          <label>📁 選擇 HTML 文件</label>
          <div class="file-upload" id="fileUpload">
            <input type="file" id="htmlFile" accept=".html,.htm" required>
            <div class="icon">📄</div>
            <div class="text">點擊或拖拽 HTML 文件到此處</div>
            <div class="selected" id="selectedFile" style="display:none;"></div>
          </div>
        </div>

        <!-- 工具名稱 -->
        <div class="form-group">
          <label for="toolName">📱 工具名稱</label>
          <input type="text" id="toolName" placeholder="例如：多功能計算器" required>
        </div>

        <!-- 工具描述 -->
        <div class="form-group">
          <label for="toolDescription">📝 工具描述</label>
          <textarea id="toolDescription" rows="3" placeholder="請描述這個工具的功能和特色..." required></textarea>
        </div>

        <!-- 圖標選擇 -->
        <div class="form-group">
          <label>🎨 選擇圖標</label>
          <select id="iconSelect">
            <option value="🛠️">🛠️ 工具</option>
            <option value="🧮">🧮 計算器</option>
            <option value="📈">📈 圖表</option>
            <option value="🎨">🎨 設計</option>
            <option value="📱">📱 手機</option>
            <option value="💻">💻 電腦</option>
            <option value="🎯">🎯 目標</option>
            <option value="⚡">⚡ 快速</option>
            <option value="🚀">🚀 火箭</option>
            <option value="💡">💡 燈泡</option>
          </select>
        </div>

        <!-- GitHub Token -->
        <div class="form-group">
          <label for="githubToken">🔑 GitHub Personal Access Token</label>
          <input type="password" id="githubToken" placeholder="ghp_xxxxxxxxxxxxxxxxxxxx" required>
          <small style="color:var(--sub); display:block; margin-top:4px;">
            <a href="https://github.com/settings/tokens" target="_blank" style="color:var(--brand);">如何獲取 GitHub Token？</a>
          </small>
        </div>

        <!-- 提交按鈕 -->
        <div style="text-align:center;">
          <button type="submit" class="btn" id="submitBtn">
            <i class="bi bi-cloud-upload"></i> 一鍵上傳並部署
          </button>
        </div>
      </form>
    </div>

    <!-- 載入中 -->
    <div class="loading" id="loading">
      <div class="spinner"></div>
      <div>正在上傳並部署您的工具...</div>
      <div style="font-size:14px; color:var(--sub); margin-top:8px;">這可能需要幾分鐘時間</div>
    </div>

    <!-- 步驟說明 -->
    <div class="steps" id="steps" style="display:none;">
      <div class="step completed">
        <div class="step-number">1</div>
        <div class="step-icon">✅</div>
        <div>
          <strong>文件上傳完成</strong><br>
          <small>HTML 文件已成功上傳到 GitHub</small>
        </div>
      </div>
      <div class="step" id="step2">
        <div class="step-number">2</div>
        <div class="step-icon">⏳</div>
        <div>
          <strong>GitHub Actions 部署中</strong><br>
          <small>正在自動部署到 GitHub Pages</small>
        </div>
      </div>
      <div class="step" id="step3">
        <div class="step-number">3</div>
        <div class="step-icon">⏳</div>
        <div>
          <strong>等待部署完成</strong><br>
          <small>通常需要 1-5 分鐘</small>
        </div>
      </div>
    </div>

    <!-- 結果顯示 -->
    <div class="result" id="result"></div>
  </div>

<script>
// 文件上傳處理
const fileUpload = document.getElementById('fileUpload');
const htmlFile = document.getElementById('htmlFile');
const selectedFile = document.getElementById('selectedFile');

// 點擊上傳
fileUpload.addEventListener('click', () => htmlFile.click());

// 文件選擇
htmlFile.addEventListener('change', (e) => {
  const file = e.target.files[0];
  if (file) {
    selectedFile.textContent = `已選擇: ${file.name}`;
    selectedFile.style.display = 'block';
  }
});

// 拖拽上傳
fileUpload.addEventListener('dragover', (e) => {
  e.preventDefault();
  fileUpload.classList.add('dragover');
});

fileUpload.addEventListener('dragleave', () => {
  fileUpload.classList.remove('dragover');
});

fileUpload.addEventListener('drop', (e) => {
  e.preventDefault();
  fileUpload.classList.remove('dragover');
  
  const files = e.dataTransfer.files;
  if (files.length > 0 && files[0].type.includes('html')) {
    htmlFile.files = files;
    selectedFile.textContent = `已選擇: ${files[0].name}`;
    selectedFile.style.display = 'block';
  }
});

// 表單提交
document.getElementById('uploadForm').addEventListener('submit', async (e) => {
  e.preventDefault();
  
  const toolName = document.getElementById('toolName').value;
  const toolDescription = document.getElementById('toolDescription').value;
  const icon = document.getElementById('iconSelect').value;
  const githubToken = document.getElementById('githubToken').value;
  const file = htmlFile.files[0];
  
  if (!file || !toolName || !toolDescription || !githubToken) {
    showResult('error', '<h3>❌ 請填寫所有必填欄位</h3>');
    return;
  }
  
  // 顯示載入中
  document.getElementById('loading').style.display = 'block';
  document.getElementById('submitBtn').disabled = true;
  
  try {
    // 顯示步驟
    document.getElementById('steps').style.display = 'block';
    
    // 步驟 1: 上傳文件
    await uploadToGitHub(file, toolName, toolDescription, icon, githubToken);
    
    // 步驟 2: 更新主頁面
    await updateMainPage(toolName, toolDescription, icon, githubToken);
    
    // 步驟 3: 觸發部署
    await triggerDeployment(githubToken);
    
    // 完成
    completeStep(2);
    completeStep(3);
    
    showResult('success', `
      <h3>🎉 上傳成功！</h3>
      <p><strong>工具名稱:</strong> ${toolName}</p>
      <p><strong>主頁面:</strong> <a href="https://sky770825.github.io/internation/" target="_blank">https://sky770825.github.io/internation/</a></p>
      <p><strong>部署狀態:</strong> 正在部署中，通常 1-5 分鐘內完成</p>
      <p><strong>下一步:</strong> 等待 GitHub Actions 完成部署後，您的工具就可以使用了！</p>
    `);
    
  } catch (error) {
    showResult('error', `
      <h3>❌ 上傳失敗</h3>
      <p>錯誤信息: ${error.message}</p>
      <p>請檢查 GitHub Token 是否正確，以及是否有足夠的權限。</p>
    `);
  } finally {
    document.getElementById('loading').style.display = 'none';
    document.getElementById('submitBtn').disabled = false;
  }
});

// 上傳到 GitHub
async function uploadToGitHub(file, toolName, toolDescription, icon, token) {
  const fileName = `${toolName.replace(/[^a-zA-Z0-9]/g, '-').toLowerCase()}.html`;
  
  // 讀取文件內容
  const content = await readFileAsText(file);
  
  // 添加返回按鈕
  const returnButton = `
  <!-- 返回按鈕 -->
  <a href="index.html" class="back-btn" style="display:inline-flex; align-items:center; gap:6px; padding:8px 12px; background:#ffb703; color:#5b3a29; border-radius:8px; text-decoration:none; font-size:14px; font-weight:600; margin-bottom:16px;">
    <i class="bi bi-arrow-left"></i> 返回工具集
  </a>
  
`;
  
  const modifiedContent = content.replace('(<body[^>]*>)', `$1\n${returnButton}`);
  
  // 上傳到 GitHub
  const response = await fetch(`https://api.github.com/repos/sky770825/internation/contents/${fileName}`, {
    method: 'PUT',
    headers: {
      'Authorization': `token ${token}`,
      'Content-Type': 'application/json',
    },
    body: JSON.stringify({
      message: `自動添加新工具: ${toolName}`,
      content: btoa(unescape(encodeURIComponent(modifiedContent))),
      branch: 'main'
    })
  });
  
  if (!response.ok) {
    throw new Error(`GitHub API 錯誤: ${response.status} ${response.statusText}`);
  }
  
  completeStep(1);
  return response.json();
}

// 更新主頁面
async function updateMainPage(toolName, toolDescription, icon, token) {
  // 獲取當前主頁面內容
  const response = await fetch('https://api.github.com/repos/sky770825/internation/contents/index.html', {
    headers: {
      'Authorization': `token ${token}`,
    }
  });
  
  if (!response.ok) {
    throw new Error('無法獲取主頁面內容');
  }
  
  const currentContent = await response.json();
  const content = atob(currentContent.content);
  
  // 檢查工具是否已存在
  if (content.includes(toolName)) {
    return; // 工具已存在
  }
  
  // 添加新工具卡片
  const fileName = `${toolName.replace(/[^a-zA-Z0-9]/g, '-').toLowerCase()}.html`;
  const newToolCard = `
      <!-- ${toolName} -->
      <a href="${fileName}" class="tool-card">
        <div class="tool-icon">${icon}</div>
        <h2 class="tool-title">${toolName}</h2>
        <p class="tool-desc">${toolDescription}</p>
        <ul class="tool-features">
          <li>功能特色 1</li>
          <li>功能特色 2</li>
          <li>功能特色 3</li>
        </ul>
        <div style="margin-top:16px;">
          <span class="btn">立即使用</span>
        </div>
      </a>
    </div>
`;
  
  const updatedContent = content.replace('(</div>\s*<!-- 頁尾 -->)', `${newToolCard}\n    $1`);
  
  // 更新主頁面
  const updateResponse = await fetch('https://api.github.com/repos/sky770825/internation/contents/index.html', {
    method: 'PUT',
    headers: {
      'Authorization': `token ${token}`,
      'Content-Type': 'application/json',
    },
    body: JSON.stringify({
      message: `更新主頁面: 添加 ${toolName}`,
      content: btoa(unescape(encodeURIComponent(updatedContent))),
      sha: currentContent.sha,
      branch: 'main'
    })
  });
  
  if (!updateResponse.ok) {
    throw new Error('無法更新主頁面');
  }
}

// 觸發部署
async function triggerDeployment(token) {
  // 創建一個空的 commit 來觸發 GitHub Actions
  const response = await fetch('https://api.github.com/repos/sky770825/internation/contents/trigger-deploy.txt', {
    method: 'PUT',
    headers: {
      'Authorization': `token ${token}`,
      'Content-Type': 'application/json',
    },
    body: JSON.stringify({
      message: `觸發部署: ${new Date().toISOString()}`,
      content: btoa('deploy'),
      branch: 'main'
    })
  });
  
  if (!response.ok) {
    throw new Error('無法觸發部署');
  }
}

// 完成步驟
function completeStep(stepNumber) {
  const step = document.getElementById(`step${stepNumber}`);
  if (step) {
    step.classList.add('completed');
    step.querySelector('.step-icon').textContent = '✅';
  }
}

// 讀取文件為文本
function readFileAsText(file) {
  return new Promise((resolve, reject) => {
    const reader = new FileReader();
    reader.onload = e => resolve(e.target.result);
    reader.onerror = e => reject(e);
    reader.readAsText(file);
  });
}

// 顯示結果
function showResult(type, content) {
  const result = document.getElementById('result');
  result.className = `result ${type}`;
  result.innerHTML = content;
  result.style.display = 'block';
  
  // 滾動到結果
  result.scrollIntoView({ behavior: 'smooth' });
}
</script>
</body>
</html>
