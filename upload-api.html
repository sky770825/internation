<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ğŸš€ çœŸæ­£çš„ä¸€éµä¸Šå‚³ HTML å·¥å…·</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
<style>
  * { box-sizing: border-box; }
  
  :root{
    --font:'Microsoft JhengHei',system-ui,-apple-system,Segoe UI,Roboto,Noto Sans TC,Arial,sans-serif;
    --bg:#fff7ed; --card:#fff; --ink:#5b3a29; --sub:#7b5b4a;
    --brand:#ff7f50; --brand2:#ffb703; --muted:#fff0e0; --line:#f2d3b1;
    --shadow:0 8px 16px rgba(0,0,0,.08); --r:14px;
    --success:#16a34a; --danger:#dc2626; --info:#2563eb;
  }
  
  html,body{ margin:0; font-family:var(--font); background:var(--bg); color:var(--ink); }
  .wrap{ max-width:800px; margin:auto; padding:clamp(10px,3vw,18px); }
  
  .hero{
    background:linear-gradient(135deg,var(--muted),#fff); border:1px solid #ffd6ad; border-radius:var(--r);
    box-shadow:var(--shadow); padding:clamp(12px,3vw,20px); margin-bottom:20px; text-align:center;
  }
  .hero h1{ margin:0; font-size:clamp(20px,5.2vw,30px); display:flex; align-items:center; justify-content:center; gap:10px }
  .hero p{ margin:8px 0 0; color:var(--sub); font-size:clamp(14px,3.5vw,16px); }
  
  .card{
    background:#fff; border:1px solid var(--line); border-radius:var(--r); 
    box-shadow:var(--shadow); padding:20px; margin-bottom:20px;
  }
  
  .form-group{ margin-bottom:20px; }
  label{ display:block; font-weight:700; margin-bottom:8px; color:var(--ink); }
  
  input, select, textarea{
    width:100%; padding:12px; border:1px solid var(--line); border-radius:10px;
    font-size:16px; outline:0; transition:.2s; background:#fff;
  }
  input:focus, select:focus, textarea:focus{ border-color:var(--brand); box-shadow:0 0 0 3px rgba(255,127,80,.23) }
  
  .file-upload{
    border:2px dashed var(--line); background:var(--muted); text-align:center; padding:40px 20px;
    border-radius:var(--r); cursor:pointer; transition:.2s;
  }
  .file-upload:hover{ border-color:var(--brand); background:var(--muted); }
  .file-upload.dragover{ border-color:var(--brand); background:var(--muted); }
  .file-upload input{ display:none; }
  .file-upload .icon{ font-size:48px; color:var(--brand); margin-bottom:16px; }
  .file-upload .text{ color:var(--sub); font-size:16px; }
  .file-upload .selected{ color:var(--success); font-weight:600; }
  
  .btn{
    display:inline-flex; align-items:center; gap:8px; justify-content:center; font-weight:700;
    padding:12px 24px; border-radius:12px; border:0; cursor:pointer; color:#fff;
    background:linear-gradient(180deg,#ff9f68,var(--brand)); box-shadow:0 8px 14px rgba(255,127,80,.28);
    font-size:16px; text-decoration:none; transition:.2s;
  }
  .btn:hover{ transform:translateY(-1px); box-shadow:0 10px 20px rgba(255,127,80,.35); }
  .btn:disabled{ opacity:0.6; cursor:not-allowed; transform:none; }
  
  .btn-ghost{ background:linear-gradient(180deg,#ffd166,var(--brand2)); color:var(--ink); }
  .btn-ghost:hover{ background:#ffd166; }
  
  .result{
    background:var(--muted); border:1px solid var(--line); border-radius:var(--r);
    padding:20px; margin-top:20px; display:none;
  }
  .result.success{ background:#f0f9ff; border-color:var(--success); }
  .result.error{ background:#fef2f2; border-color:var(--danger); }
  .result.info{ background:#f0f9ff; border-color:var(--info); }
  
  .back-btn{
    display:inline-flex; align-items:center; gap:6px; padding:8px 12px;
    background:var(--brand2); color:var(--ink); border-radius:8px; text-decoration:none;
    font-size:14px; font-weight:600; margin-bottom:16px;
  }
  .back-btn:hover{ background:#ffd166; transform:translateY(-1px); }
  
  .loading{ display:none; text-align:center; padding:20px; }
  .spinner{ width:40px; height:40px; border:4px solid var(--muted); border-top:4px solid var(--brand); border-radius:50%; animation:spin 1s linear infinite; margin:0 auto 16px; }
  @keyframes spin{ 0%{ transform:rotate(0deg); } 100%{ transform:rotate(360deg); } }
  
  .steps{ display:grid; gap:16px; margin:20px 0; }
  .step{ 
    background:var(--muted); border:1px solid var(--line); border-radius:var(--r); 
    padding:16px; display:flex; align-items:center; gap:12px;
  }
  .step.completed{ background:#f0f9ff; border-color:var(--success); }
  .step-icon{ font-size:24px; }
  .step.completed .step-icon{ color:var(--success); }
  .step-number{ 
    width:32px; height:32px; border-radius:50%; background:var(--line); 
    display:flex; align-items:center; justify-content:center; font-weight:700; font-size:14px;
  }
  .step.completed .step-number{ background:var(--success); color:#fff; }
</style>
</head>
<body>
  <div class="wrap">
    <!-- è¿”å›æŒ‰éˆ• -->
    <a href="index.html" class="back-btn">
      <i class="bi bi-arrow-left"></i> è¿”å›å·¥å…·é›†
    </a>

    <!-- é é¦– -->
    <section class="hero">
      <h1><i class="bi bi-cloud-upload"></i> çœŸæ­£çš„ä¸€éµä¸Šå‚³ HTML å·¥å…·</h1>
      <p>é€šé GitHub API ç›´æ¥ä¸Šå‚³ä¸¦éƒ¨ç½²æ‚¨çš„ HTML å·¥å…·</p>
    </section>

    <!-- ä¸Šå‚³è¡¨å–® -->
    <div class="card">
      <form id="uploadForm">
        <!-- æ–‡ä»¶ä¸Šå‚³ -->
        <div class="form-group">
          <label>ğŸ“ é¸æ“‡ HTML æ–‡ä»¶</label>
          <div class="file-upload" id="fileUpload">
            <input type="file" id="htmlFile" accept=".html,.htm" required>
            <div class="icon">ğŸ“„</div>
            <div class="text">é»æ“Šæˆ–æ‹–æ‹½ HTML æ–‡ä»¶åˆ°æ­¤è™•</div>
            <div class="selected" id="selectedFile" style="display:none;"></div>
          </div>
        </div>

        <!-- å·¥å…·åç¨± -->
        <div class="form-group">
          <label for="toolName">ğŸ“± å·¥å…·åç¨±</label>
          <input type="text" id="toolName" placeholder="ä¾‹å¦‚ï¼šå¤šåŠŸèƒ½è¨ˆç®—å™¨" required>
        </div>

        <!-- å·¥å…·æè¿° -->
        <div class="form-group">
          <label for="toolDescription">ğŸ“ å·¥å…·æè¿°</label>
          <textarea id="toolDescription" rows="3" placeholder="è«‹æè¿°é€™å€‹å·¥å…·çš„åŠŸèƒ½å’Œç‰¹è‰²..." required></textarea>
        </div>

        <!-- åœ–æ¨™é¸æ“‡ -->
        <div class="form-group">
          <label>ğŸ¨ é¸æ“‡åœ–æ¨™</label>
          <select id="iconSelect">
            <option value="ğŸ› ï¸">ğŸ› ï¸ å·¥å…·</option>
            <option value="ğŸ§®">ğŸ§® è¨ˆç®—å™¨</option>
            <option value="ğŸ“ˆ">ğŸ“ˆ åœ–è¡¨</option>
            <option value="ğŸ¨">ğŸ¨ è¨­è¨ˆ</option>
            <option value="ğŸ“±">ğŸ“± æ‰‹æ©Ÿ</option>
            <option value="ğŸ’»">ğŸ’» é›»è…¦</option>
            <option value="ğŸ¯">ğŸ¯ ç›®æ¨™</option>
            <option value="âš¡">âš¡ å¿«é€Ÿ</option>
            <option value="ğŸš€">ğŸš€ ç«ç®­</option>
            <option value="ğŸ’¡">ğŸ’¡ ç‡ˆæ³¡</option>
          </select>
        </div>

        <!-- GitHub Token -->
        <div class="form-group">
          <label for="githubToken">ğŸ”‘ GitHub Personal Access Token</label>
          <input type="password" id="githubToken" placeholder="ghp_xxxxxxxxxxxxxxxxxxxx" required>
          <small style="color:var(--sub); display:block; margin-top:4px;">
            <a href="https://github.com/settings/tokens" target="_blank" style="color:var(--brand);">å¦‚ä½•ç²å– GitHub Tokenï¼Ÿ</a>
          </small>
        </div>

        <!-- æäº¤æŒ‰éˆ• -->
        <div style="text-align:center;">
          <button type="submit" class="btn" id="submitBtn">
            <i class="bi bi-cloud-upload"></i> ä¸€éµä¸Šå‚³ä¸¦éƒ¨ç½²
          </button>
        </div>
      </form>
    </div>

    <!-- è¼‰å…¥ä¸­ -->
    <div class="loading" id="loading">
      <div class="spinner"></div>
      <div>æ­£åœ¨ä¸Šå‚³ä¸¦éƒ¨ç½²æ‚¨çš„å·¥å…·...</div>
      <div style="font-size:14px; color:var(--sub); margin-top:8px;">é€™å¯èƒ½éœ€è¦å¹¾åˆ†é˜æ™‚é–“</div>
    </div>

    <!-- æ­¥é©Ÿèªªæ˜ -->
    <div class="steps" id="steps" style="display:none;">
      <div class="step completed">
        <div class="step-number">1</div>
        <div class="step-icon">âœ…</div>
        <div>
          <strong>æ–‡ä»¶ä¸Šå‚³å®Œæˆ</strong><br>
          <small>HTML æ–‡ä»¶å·²æˆåŠŸä¸Šå‚³åˆ° GitHub</small>
        </div>
      </div>
      <div class="step" id="step2">
        <div class="step-number">2</div>
        <div class="step-icon">â³</div>
        <div>
          <strong>GitHub Actions éƒ¨ç½²ä¸­</strong><br>
          <small>æ­£åœ¨è‡ªå‹•éƒ¨ç½²åˆ° GitHub Pages</small>
        </div>
      </div>
      <div class="step" id="step3">
        <div class="step-number">3</div>
        <div class="step-icon">â³</div>
        <div>
          <strong>ç­‰å¾…éƒ¨ç½²å®Œæˆ</strong><br>
          <small>é€šå¸¸éœ€è¦ 1-5 åˆ†é˜</small>
        </div>
      </div>
    </div>

    <!-- çµæœé¡¯ç¤º -->
    <div class="result" id="result"></div>
  </div>

<script>
// æ–‡ä»¶ä¸Šå‚³è™•ç†
const fileUpload = document.getElementById('fileUpload');
const htmlFile = document.getElementById('htmlFile');
const selectedFile = document.getElementById('selectedFile');

// é»æ“Šä¸Šå‚³
fileUpload.addEventListener('click', () => htmlFile.click());

// æ–‡ä»¶é¸æ“‡
htmlFile.addEventListener('change', (e) => {
  const file = e.target.files[0];
  if (file) {
    selectedFile.textContent = `å·²é¸æ“‡: ${file.name}`;
    selectedFile.style.display = 'block';
  }
});

// æ‹–æ‹½ä¸Šå‚³
fileUpload.addEventListener('dragover', (e) => {
  e.preventDefault();
  fileUpload.classList.add('dragover');
});

fileUpload.addEventListener('dragleave', () => {
  fileUpload.classList.remove('dragover');
});

fileUpload.addEventListener('drop', (e) => {
  e.preventDefault();
  fileUpload.classList.remove('dragover');
  
  const files = e.dataTransfer.files;
  if (files.length > 0 && files[0].type.includes('html')) {
    htmlFile.files = files;
    selectedFile.textContent = `å·²é¸æ“‡: ${files[0].name}`;
    selectedFile.style.display = 'block';
  }
});

// è¡¨å–®æäº¤
document.getElementById('uploadForm').addEventListener('submit', async (e) => {
  e.preventDefault();
  
  const toolName = document.getElementById('toolName').value;
  const toolDescription = document.getElementById('toolDescription').value;
  const icon = document.getElementById('iconSelect').value;
  const githubToken = document.getElementById('githubToken').value;
  const file = htmlFile.files[0];
  
  if (!file || !toolName || !toolDescription || !githubToken) {
    showResult('error', '<h3>âŒ è«‹å¡«å¯«æ‰€æœ‰å¿…å¡«æ¬„ä½</h3>');
    return;
  }
  
  // é¡¯ç¤ºè¼‰å…¥ä¸­
  document.getElementById('loading').style.display = 'block';
  document.getElementById('submitBtn').disabled = true;
  
  try {
    // é¡¯ç¤ºæ­¥é©Ÿ
    document.getElementById('steps').style.display = 'block';
    
    // æ­¥é©Ÿ 1: ä¸Šå‚³æ–‡ä»¶
    await uploadToGitHub(file, toolName, toolDescription, icon, githubToken);
    
    // æ­¥é©Ÿ 2: æ›´æ–°ä¸»é é¢
    await updateMainPage(toolName, toolDescription, icon, githubToken);
    
    // æ­¥é©Ÿ 3: è§¸ç™¼éƒ¨ç½²
    await triggerDeployment(githubToken);
    
    // å®Œæˆ
    completeStep(2);
    completeStep(3);
    
    showResult('success', `
      <h3>ğŸ‰ ä¸Šå‚³æˆåŠŸï¼</h3>
      <p><strong>å·¥å…·åç¨±:</strong> ${toolName}</p>
      <p><strong>ä¸»é é¢:</strong> <a href="https://sky770825.github.io/internation/" target="_blank">https://sky770825.github.io/internation/</a></p>
      <p><strong>éƒ¨ç½²ç‹€æ…‹:</strong> æ­£åœ¨éƒ¨ç½²ä¸­ï¼Œé€šå¸¸ 1-5 åˆ†é˜å…§å®Œæˆ</p>
      <p><strong>ä¸‹ä¸€æ­¥:</strong> ç­‰å¾… GitHub Actions å®Œæˆéƒ¨ç½²å¾Œï¼Œæ‚¨çš„å·¥å…·å°±å¯ä»¥ä½¿ç”¨äº†ï¼</p>
    `);
    
  } catch (error) {
    showResult('error', `
      <h3>âŒ ä¸Šå‚³å¤±æ•—</h3>
      <p>éŒ¯èª¤ä¿¡æ¯: ${error.message}</p>
      <p>è«‹æª¢æŸ¥ GitHub Token æ˜¯å¦æ­£ç¢ºï¼Œä»¥åŠæ˜¯å¦æœ‰è¶³å¤ çš„æ¬Šé™ã€‚</p>
    `);
  } finally {
    document.getElementById('loading').style.display = 'none';
    document.getElementById('submitBtn').disabled = false;
  }
});

// ä¸Šå‚³åˆ° GitHub
async function uploadToGitHub(file, toolName, toolDescription, icon, token) {
  const fileName = `${toolName.replace(/[^a-zA-Z0-9]/g, '-').toLowerCase()}.html`;
  
  // è®€å–æ–‡ä»¶å…§å®¹
  const content = await readFileAsText(file);
  
  // æ·»åŠ è¿”å›æŒ‰éˆ•
  const returnButton = `
  <!-- è¿”å›æŒ‰éˆ• -->
  <a href="index.html" class="back-btn" style="display:inline-flex; align-items:center; gap:6px; padding:8px 12px; background:#ffb703; color:#5b3a29; border-radius:8px; text-decoration:none; font-size:14px; font-weight:600; margin-bottom:16px;">
    <i class="bi bi-arrow-left"></i> è¿”å›å·¥å…·é›†
  </a>
  
`;
  
  const modifiedContent = content.replace('(<body[^>]*>)', `$1\n${returnButton}`);
  
  // ä¸Šå‚³åˆ° GitHub
  const response = await fetch(`https://api.github.com/repos/sky770825/internation/contents/${fileName}`, {
    method: 'PUT',
    headers: {
      'Authorization': `token ${token}`,
      'Content-Type': 'application/json',
    },
    body: JSON.stringify({
      message: `è‡ªå‹•æ·»åŠ æ–°å·¥å…·: ${toolName}`,
      content: btoa(unescape(encodeURIComponent(modifiedContent))),
      branch: 'main'
    })
  });
  
  if (!response.ok) {
    throw new Error(`GitHub API éŒ¯èª¤: ${response.status} ${response.statusText}`);
  }
  
  completeStep(1);
  return response.json();
}

// æ›´æ–°ä¸»é é¢
async function updateMainPage(toolName, toolDescription, icon, token) {
  // ç²å–ç•¶å‰ä¸»é é¢å…§å®¹
  const response = await fetch('https://api.github.com/repos/sky770825/internation/contents/index.html', {
    headers: {
      'Authorization': `token ${token}`,
    }
  });
  
  if (!response.ok) {
    throw new Error('ç„¡æ³•ç²å–ä¸»é é¢å…§å®¹');
  }
  
  const currentContent = await response.json();
  const content = atob(currentContent.content);
  
  // æª¢æŸ¥å·¥å…·æ˜¯å¦å·²å­˜åœ¨
  if (content.includes(toolName)) {
    return; // å·¥å…·å·²å­˜åœ¨
  }
  
  // æ·»åŠ æ–°å·¥å…·å¡ç‰‡
  const fileName = `${toolName.replace(/[^a-zA-Z0-9]/g, '-').toLowerCase()}.html`;
  const newToolCard = `
      <!-- ${toolName} -->
      <a href="${fileName}" class="tool-card">
        <div class="tool-icon">${icon}</div>
        <h2 class="tool-title">${toolName}</h2>
        <p class="tool-desc">${toolDescription}</p>
        <ul class="tool-features">
          <li>åŠŸèƒ½ç‰¹è‰² 1</li>
          <li>åŠŸèƒ½ç‰¹è‰² 2</li>
          <li>åŠŸèƒ½ç‰¹è‰² 3</li>
        </ul>
        <div style="margin-top:16px;">
          <span class="btn">ç«‹å³ä½¿ç”¨</span>
        </div>
      </a>
    </div>
`;
  
  const updatedContent = content.replace('(</div>\s*<!-- é å°¾ -->)', `${newToolCard}\n    $1`);
  
  // æ›´æ–°ä¸»é é¢
  const updateResponse = await fetch('https://api.github.com/repos/sky770825/internation/contents/index.html', {
    method: 'PUT',
    headers: {
      'Authorization': `token ${token}`,
      'Content-Type': 'application/json',
    },
    body: JSON.stringify({
      message: `æ›´æ–°ä¸»é é¢: æ·»åŠ  ${toolName}`,
      content: btoa(unescape(encodeURIComponent(updatedContent))),
      sha: currentContent.sha,
      branch: 'main'
    })
  });
  
  if (!updateResponse.ok) {
    throw new Error('ç„¡æ³•æ›´æ–°ä¸»é é¢');
  }
}

// è§¸ç™¼éƒ¨ç½²
async function triggerDeployment(token) {
  // å‰µå»ºä¸€å€‹ç©ºçš„ commit ä¾†è§¸ç™¼ GitHub Actions
  const response = await fetch('https://api.github.com/repos/sky770825/internation/contents/trigger-deploy.txt', {
    method: 'PUT',
    headers: {
      'Authorization': `token ${token}`,
      'Content-Type': 'application/json',
    },
    body: JSON.stringify({
      message: `è§¸ç™¼éƒ¨ç½²: ${new Date().toISOString()}`,
      content: btoa('deploy'),
      branch: 'main'
    })
  });
  
  if (!response.ok) {
    throw new Error('ç„¡æ³•è§¸ç™¼éƒ¨ç½²');
  }
}

// å®Œæˆæ­¥é©Ÿ
function completeStep(stepNumber) {
  const step = document.getElementById(`step${stepNumber}`);
  if (step) {
    step.classList.add('completed');
    step.querySelector('.step-icon').textContent = 'âœ…';
  }
}

// è®€å–æ–‡ä»¶ç‚ºæ–‡æœ¬
function readFileAsText(file) {
  return new Promise((resolve, reject) => {
    const reader = new FileReader();
    reader.onload = e => resolve(e.target.result);
    reader.onerror = e => reject(e);
    reader.readAsText(file);
  });
}

// é¡¯ç¤ºçµæœ
function showResult(type, content) {
  const result = document.getElementById('result');
  result.className = `result ${type}`;
  result.innerHTML = content;
  result.style.display = 'block';
  
  // æ»¾å‹•åˆ°çµæœ
  result.scrollIntoView({ behavior: 'smooth' });
}
</script>
</body>
</html>
