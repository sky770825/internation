<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>èº«å¿ƒéˆç˜¦èº«å°æ¸¬é©—ï½œå¡”ç¾…æ˜Ÿç©ºé¢¨</title>
  <!-- Bootstrap Iconsï¼ˆåƒ…ç”¨æ–¼åœ–ç¤ºä¿®é£¾ï¼‰ -->
  <link rel="preconnect" href="https://cdn.jsdelivr.net" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet" />

  <style>
    /* =========================================================
       Bootswatchï¼ˆMinty é¢¨æ ¼ç²¾ç°¡ç‰ˆâ€§å·²å…§åµŒï¼‰
       â€» ç„¡éœ€å¤–è¯ï¼Œç¶­æŒä¸€è‡´çš„æŒ‰éˆ•/è¡¨å–®å¤–è§€
       ========================================================= */
    :root{
      --bs-primary:#2ecc71;      /* æ˜äº®è‰ç¶  */
      --bs-secondary:#6c757d;
      --bs-dark:#212529;
      --bs-light:#f8f9fa;
      --bs-body-color:#f5f5f8;
      --bs-body-bg:#0d0b18;      /* æ·±å¤œè—ç´« */
      --card-bg:rgba(23, 20, 38, 0.65);
      --glass:rgba(255,255,255,0.08);
      --accent:#b892ff;          /* ç¥ç§˜ç´« */
      --accent-2:#ffd08a;        /* æº«æš–é‡‘ */
      --muted:#a2a2a8;
      --ring:0 0 0 .2rem rgba(46,204,113,.35);
      --success:#39d98a;
      --danger:#ff6b6b;
      --warning:#ffd166;
      --info:#66d9ff;
    }
    * { box-sizing: border-box; } /* ğŸ”’é¿å…å…ƒç´ è¶…å‡ºå®¹å™¨ */
    html,body{height:100%;}
    body{
      margin:0;
      font-family:"Microsoft JhengHei", system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans TC", "PingFang TC", "Heiti TC", sans-serif;
      color:var(--bs-body-color);
      background: radial-gradient(1200px 800px at 10% 10%, #1a1430 0%, #0d0b18 60%, #080611 100%);
      letter-spacing: .2px;
      line-height: 1.7;
      font-size: 17px; /* ğŸ“±å­—é«”ä¸è¦å¤ªå° */
    }

    /* ---------------------------------------------------------
       æ˜Ÿç©ºèƒŒæ™¯ï¼ˆæŸ”å’Œæµå‹• + å¾®é–ƒçˆï¼‰
       --------------------------------------------------------- */
    .stars, .twinkle, .nebula {
      position: fixed; inset:0; pointer-events:none; z-index:0;
    }
    .stars {
      background:
        radial-gradient(1px 1px at 10% 20%, #fff 70%, transparent 72%) repeat,
        radial-gradient(1px 1px at 30% 80%, #fff 70%, transparent 72%) repeat,
        radial-gradient(1px 1px at 70% 30%, #fff 70%, transparent 72%) repeat,
        radial-gradient(1px 1px at 90% 60%, #fff 70%, transparent 72%) repeat;
      background-size: 400px 400px, 500px 500px, 600px 600px, 700px 700px;
      opacity:.45;
      animation: drift 60s linear infinite;
    }
    .twinkle{
      background:
        radial-gradient(2px 2px at 20% 30%, #fff 70%, transparent 72%) repeat,
        radial-gradient(2px 2px at 80% 50%, #fff 70%, transparent 72%) repeat,
        radial-gradient(2px 2px at 50% 80%, #fff 70%, transparent 72%) repeat;
      background-size: 600px 600px, 700px 700px, 800px 800px;
      mix-blend-mode: screen;
      opacity:.25;
      animation: twinkle 4.6s ease-in-out infinite;
    }
    .nebula{
      background:
        radial-gradient(600px 300px at 15% 70%, rgba(184,146,255,.18), transparent 70%),
        radial-gradient(500px 300px at 85% 25%, rgba(255,208,138,.16), transparent 70%),
        radial-gradient(400px 260px at 60% 80%, rgba(46,204,113,.10), transparent 70%);
      filter: blur(8px);
      animation: pulse 12s ease-in-out infinite;
    }
    @keyframes drift{ to{ background-position: 600px 0, -700px 0, 800px 0, -900px 0; } }
    @keyframes twinkle{ 50%{ opacity:.4 } }
    @keyframes pulse{ 50%{ opacity:.8 } }

    /* ---------------------------------------------------------
       ç‰ˆé¢ï¼šæ‰‹æ©Ÿå„ªå…ˆã€ç½®ä¸­å¡ç‰‡ã€IGé¢¨ç»ç’ƒè³ªæ„Ÿ
       --------------------------------------------------------- */
    .wrap{
      position: relative;
      z-index: 1;
      min-height: 100%;
      display: grid;
      place-items: center;
      padding: 20px 14px 80px;
    }
    .card{
      width: 100%;
      max-width: 920px; /* å¹³æ¿ä»¥ä¸Šå¤šä¸€é»ç©ºé–“ */
      background: linear-gradient(180deg, rgba(255,255,255,0.08), rgba(255,255,255,0.03));
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255,255,255,.12);
      border-radius: 24px;
      box-shadow: 0 10px 40px rgba(0,0,0,.35);
      overflow: hidden;
    }
    .card-header{
      padding: 18px 16px;
      background: linear-gradient(120deg, rgba(46,204,113,.24), rgba(184,146,255,.22));
      border-bottom: 1px solid rgba(255,255,255,.1);
      display:flex; align-items:center; gap:10px; justify-content:space-between;
    }
    .coach{
      font-weight: 800; font-size: 20px;
      letter-spacing: .5px;
      display:flex; align-items:center; gap:8px;
    }
    .coach .badge{
      font-size:12px; padding:6px 10px; border-radius:999px;
      background:rgba(255,255,255,.16); color:#fff;
    }
    .logo-chip{
      display:flex; align-items:center; gap:8px;
      font-size:12px; padding:6px 10px; border-radius:999px;
      background:rgba(255,255,255,.12);
    }
    .title{
      font-size: 22px; font-weight: 900; margin: 8px 0 0;
    }

    .card-body{ padding: 18px; }

    .hero{
      display: grid; gap: 14px;
      grid-template-columns: 1fr;
    }
    .tarot{
      width: 100%;
      aspect-ratio: 3/4;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,.14);
      background:
        radial-gradient(120px 120px at 70% 20%, rgba(255,208,138,.18), transparent 60%),
        radial-gradient(200px 140px at 30% 80%, rgba(184,146,255,.18), transparent 60%),
        linear-gradient(160deg, #1c1634, #0f0c1d 60%, #0d0b18);
      position:relative; overflow: hidden;
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.06), 0 10px 30px rgba(0,0,0,.35);
    }
    .tarot .moon{
      position:absolute; right:10%; top:12%; width:20%;
      filter: drop-shadow(0 2px 6px rgba(255,255,255,.35));
    }
    .tarot .caption{
      position:absolute; left:0; right:0; bottom:14px; text-align:center; font-weight:800; letter-spacing:.3px;
      text-transform: uppercase; font-size:14px; color:#ffdca8;
    }

    .cta-row{
      display:flex; flex-wrap:wrap; gap:10px; margin-top: 4px;
    }
    .btn{
      cursor:pointer; user-select:none;
      border: 1px solid rgba(255,255,255,.2);
      border-radius: 999px;
      padding: 12px 18px;
      font-weight: 800;
      letter-spacing: .3px;
      text-decoration:none;
      display:inline-flex; align-items:center; gap:8px;
      transition: transform .06s ease, box-shadow .2s ease, opacity .2s ease, background .2s ease;
      will-change: transform;
      font-size: 16px;
      background: rgba(255,255,255,.08);
      color:#fff;
    }
    .btn:active{ transform: translateY(1px) scale(.99); }
    .btn:focus-visible{ outline: none; box-shadow: var(--ring); }
    .btn-primary{
      background: linear-gradient(180deg, #39d98a, #2ecc71);
      color:#072; border-color: rgba(0,0,0,.15);
      text-shadow: 0 1px 0 rgba(255,255,255,.25);
      box-shadow: 0 6px 14px rgba(46,204,113,.35);
    }
    .btn-primary:hover{ opacity:.95; }
    .btn-ghost{
      background: rgba(255,255,255,.08);
      color:#fff;
      border-color: rgba(255,255,255,.18);
    }
    .btn-warning{
      background: linear-gradient(180deg, var(--warning), #ffcc66);
      color:#4a3b00;
      border-color: rgba(0,0,0,.15);
      box-shadow: 0 6px 14px rgba(255,209,102,.25);
    }
    .btn-danger{
      background: linear-gradient(180deg, #ff8b8b, var(--danger));
      color:#3c0000;
      border-color: rgba(0,0,0,.15);
      box-shadow: 0 6px 14px rgba(255,107,107,.25);
    }

    .progress-wrap{ margin:16px 0 10px; }
    .progress{
      height: 10px; background: rgba(255,255,255,.08);
      border-radius:999px; overflow:hidden;
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.06);
    }
    .progress-bar{
      height:100%; width:0%;
      background: linear-gradient(90deg, #2ecc71, #b6f3d2);
      transition: width .35s ease;
    }

    /* ---------------------------------------------------------
       è¡¨å–®/é¡Œç›®ï¼ˆå¤šé¸ï¼‰- å¤§å°ºå¯¸å¯é»å¥½æ“ä½œ
       --------------------------------------------------------- */
    .q{
      margin: 8px 0 12px; font-size: 18px; font-weight: 800; color:#fff;
      display:flex; align-items:center; gap:8px;
    }
    .opt{
      display:flex; align-items:flex-start; gap:10px;
      background: var(--glass);
      border:1px solid rgba(255,255,255,.12);
      padding: 12px; border-radius: 14px; margin: 10px 0;
      transition: background .2s ease, border-color .2s ease, transform .08s ease;
    }
    .opt:hover{ background: rgba(255,255,255,.12); transform: translateY(-1px); }
    .opt input[type="checkbox"]{ width:22px; height:22px; margin-top:2px; accent-color: var(--bs-primary); }
    input, select, textarea { max-width: 100%; } /* ğŸ”’é‡è¦è¦ç¯„ï¼šè¼¸å…¥å…ƒä»¶ä¸è¶…å‡ºå®¹å™¨ */

    .nav-row{ display:flex; justify-content:space-between; gap:10px; margin-top: 10px; }
    .muted{ color: var(--muted); font-size: 14px; }

    /* ---------------------------------------------------------
       çµæœå¡ç‰‡
       --------------------------------------------------------- */
    .result-card{
      background: linear-gradient(180deg, rgba(46,204,113,.14), rgba(184,146,255,.10));
      border:1px solid rgba(255,255,255,.16);
      border-radius:18px; padding:14px; margin-top:10px;
    }
    .tag{
      display:inline-block; padding:6px 10px; border-radius:999px;
      background:rgba(255,255,255,.18); color:#fff; font-size:12px; margin: 0 6px 6px 0;
    }

    /* ---------------------------------------------------------
       éŸ³æ¨‚æ§åˆ¶ï¼ˆWeb Audioï¼‰
       --------------------------------------------------------- */
    .audio-toggle{
      position: fixed; right: 16px; bottom: 16px; z-index: 5;
      border-radius: 999px; padding:10px 14px; font-weight:800; font-size:14px;
      background: rgba(255,255,255,.12); border:1px solid rgba(255,255,255,.2); color:#fff;
      box-shadow: 0 6px 16px rgba(0,0,0,.3);
      display:flex; align-items:center; gap:8px;
    }

    /* ---------------------------------------------------------
       RWD å¾®èª¿ï¼ˆå¹³æ¿ä»¥ä¸Šå°‡åœ–æ–‡å·¦å³æ’ï¼‰
       --------------------------------------------------------- */
    @media(min-width: 768px){
      .hero{
        grid-template-columns: 1fr 1.1fr;
        align-items:center;
      }
      .title{ font-size: 26px; }
      body{ font-size: 18px; }
    }
  </style>
</head>

<body>
  <!-- èƒŒæ™¯å±¤ï¼šæ˜Ÿç©ºèˆ‡éœ§æ°£ï¼ˆåƒ…è¦–è¦ºç”¨ï¼Œä¸å½±éŸ¿äº’å‹•ï¼‰ -->
  <div class="stars" aria-hidden="true"></div>
  <div class="twinkle" aria-hidden="true"></div>
  <div class="nebula" aria-hidden="true"></div>

  <main class="wrap">
    <section class="card" role="region" aria-label="èº«å¿ƒéˆç˜¦èº«å°æ¸¬é©—å¡ç‰‡">
      <div class="card-header">
        <div class="coach">
          <i class="bi bi-stars"></i>
          <span>èº«å¿ƒéˆç˜¦èº«æ•™ç·´æ¹˜èŠ¸</span>
          <span class="badge">Mystic Coach</span>
        </div>
        <div class="logo-chip" aria-hidden="true">
          <i class="bi bi-moon-stars"></i> å¡”ç¾…æ˜Ÿç©ºé¢¨
        </div>
      </div>

      <div class="card-body">
        <!-- é¦–å±ï¼šå¡”ç¾…å¡èˆ‡ä¸»æ¨™ -->
        <div class="hero">
          <div class="tarot" aria-hidden="true">
            <!-- ç¥ç§˜å¡”ç¾…ï¼šæœˆäº®åœ–ç¤ºï¼ˆä»¥SVGå…§åµŒï¼Œç„¡å¤–è¯ï¼‰ -->
            <svg class="moon" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
              <!-- è¨»è§£ï¼šä½¿ç”¨æ¼¸å±¤èˆ‡é«˜å…‰ï¼Œåšå‡ºæŸ”äº®æœˆäº® -->
              <defs>
                <radialGradient id="g" cx="50%" cy="50%" r="50%">
                  <stop offset="0%" stop-color="#fffbe6"/>
                  <stop offset="60%" stop-color="#ffe6a3"/>
                  <stop offset="100%" stop-color="rgba(255,255,255,0)"/>
                </radialGradient>
              </defs>
              <circle cx="50" cy="50" r="20" fill="url(#g)"/>
            </svg>
            <div class="caption">Tarot of Slim Soul âœ¦</div>
          </div>

          <div>
            <h1 class="title">
              <i class="bi bi-magic"></i> èº«å¿ƒéˆç˜¦èº«å°æ¸¬é©—
            </h1>
            <p class="muted">ç”¨ 2â€“3 åˆ†é˜ï¼Œç­è§£ä½ ç›®å‰åœ¨ã€Œèº«Ã—å¿ƒÃ—éˆã€æ¸›é‡æ—…ç¨‹çš„å‚¾å‘ï¼Œæ‹¿åˆ°æ•™ç·´æ¹˜èŠ¸çš„å®¢è£½å»ºè­° âœ¨</p>

            <div class="cta-row">
              <button id="btnStart" class="btn btn-primary">
                <i class="bi bi-play-fill"></i> é–‹å§‹æ¸¬é©—
              </button>
              <button id="btnReset" class="btn btn-ghost" disabled>
                <i class="bi bi-arrow-counterclockwise"></i> é‡æ–°é–‹å§‹
              </button>
              <button id="btnSound" class="audio-toggle" aria-pressed="false" aria-label="åˆ‡æ›éŸ³æ•ˆ">
                <i class="bi bi-volume-up"></i> éŸ³æ•ˆï¼šé–‹
              </button>
            </div>

            <!-- é€²åº¦æ¢ -->
            <div class="progress-wrap" aria-hidden="false" aria-label="ä½œç­”é€²åº¦">
              <div class="progress"><div class="progress-bar" id="bar" style="width:0%"></div></div>
              <div class="muted" id="progressText">å°šæœªé–‹å§‹</div>
            </div>
          </div>
        </div>

        <!-- é¡Œç›®å€ï¼šä»¥åˆ†é å‘ˆç¾ï¼Œè¡Œå‹•è£ç½®å‹å–„ -->
        <form id="quiz" novalidate>
          <!-- è¨­è¨ˆèªªæ˜ï¼š
               1. æ¯ä¸€é  1 é¡Œï¼ˆå¤šé¸ï¼‰ï¼Œå¯ä¸Šä¸€æ­¥/ä¸‹ä¸€æ­¥ã€‚
               2. æ¯ä¸€é¸é …å¸¶æ¬Šé‡ï¼šèº«(body)/å¿ƒ(mind)/éˆ(spirit)ã€‚
               3. å®Œæˆå¾Œå½™æ•´æœ€é«˜åˆ†é¢å‘ï¼Œè¼¸å‡ºå»ºè­°ã€‚ -->

          <div id="qContainer"></div>

          <div class="nav-row">
            <button type="button" id="btnPrev" class="btn btn-ghost" disabled>
              <i class="bi bi-arrow-left"></i> ä¸Šä¸€æ­¥
            </button>
            <div style="display:flex; gap:10px;">
              <button type="button" id="btnNext" class="btn btn-warning" disabled>
                ä¸‹ä¸€æ­¥ <i class="bi bi-arrow-right"></i>
              </button>
              <button type="submit" id="btnSubmit" class="btn btn-primary" disabled>
                <i class="bi bi-emoji-sunglasses"></i> çœ‹çµæœ
              </button>
            </div>
          </div>
        </form>

        <!-- çµæœå€ -->
        <div id="result" class="result-card" style="display:none;" tabindex="-1" aria-live="polite">
          <h2 style="margin:0 0 8px; font-size:22px; font-weight:900;">
            <i class="bi bi-award"></i> ä½ çš„èº«å¿ƒéˆç˜¦èº«å‚¾å‘
          </h2>
          <div id="resultTags" style="margin-bottom:8px;"></div>
          <p id="resultText" style="margin:6px 0 0;"></p>
        </div>

        <p class="muted" style="margin-top:12px;">
          <i class="bi bi-shield-check"></i> å°æé†’ï¼šæ­¤æ¸¬é©—åƒ…ä½œç‚ºè‡ªæˆ‘è¦ºå¯Ÿèˆ‡å»ºç«‹è¡Œå‹•æ–¹å‘ä¹‹ç”¨ï¼Œè‹¥æœ‰é†«ç™‚éœ€æ±‚è«‹å°‹æ±‚å°ˆæ¥­å”åŠ©å–”ã€‚
        </p>
      </div>
    </section>
  </main>

  <script>
    /* =========================================================
       JS äº’å‹•é‚è¼¯
       - RWDï¼šè¡¨å–®å€å¡Šæ¡å–®æ¬„ï¼Œæ‰‹æ©Ÿæ˜“é»
       - å¯åŠæ€§ï¼šéµç›¤å°è¦½ / aria-live åœ¨çµæœè™•æ’­å ±
       - éŸ³æ•ˆï¼šWeb Audio API å‹•æ…‹ç”¢ç”Ÿæç¤ºéŸ³/å®ŒæˆéŸ³
       - è¨»è§£ï¼šé‡è¦æ­¥é©Ÿçš†æœ‰ä¸­æ–‡èªªæ˜ï¼Œæ–¹ä¾¿ç¶­è­·
       ========================================================= */

    // -----------------------------
    // é¡Œåº«ï¼šæ¯é¡Œå¤šé¸ï¼Œæ¯å€‹é¸é …å°èº«/å¿ƒ/éˆåŠ æ¬Š
    // -----------------------------
    const QUESTIONS = [
      {
        title: "æœ€è¿‘å¡é—œæœ€æ˜é¡¯çš„æ˜¯ï¼Ÿ",
        icon: "bi-flag",
        options: [
          { text: "ç¡ä¸å¥½ã€ä»£è¬æ„Ÿè¦ºæ…¢", w:{b:2,m:0,s:0} },
          { text: "æƒ…ç·’å®¹æ˜“æ³¢å‹•ã€å£“åŠ›å¤§å°±æƒ³åƒ", w:{b:0,m:2,s:0} },
          { text: "å‹•åŠ›å¿½é«˜å¿½ä½ã€å®¹æ˜“æ”¾æ£„", w:{b:0,m:1,s:1} },
        ]
      },
      {
        title: "ä½ åå¥½çš„é‹å‹•é¢¨æ ¼ï¼Ÿ",
        icon: "bi-bicycle",
        options: [
          { text: "è¦å¾‹é‡è¨“/è‚ŒåŠ›è¨“ç·´", w:{b:2,m:0,s:0} },
          { text: "ç‘œä¼½/ä¼¸å±•/å‘¼å¸",   w:{b:1,m:0,s:1} },
          { text: "è·Ÿè‘—å¿ƒæƒ…èµ°ï¼Œæƒ³å‹•å°±å‹•", w:{b:0,m:0,s:2} },
        ]
      },
      {
        title: "é¢å°èª˜æƒ‘é£Ÿç‰©çš„åæ‡‰ï¼Ÿ",
        icon: "bi-emoji-smile",
        options: [
          { text: "å…ˆåƒè›‹ç™½è³ª/çº–ç¶­å£“å£“é©š", w:{b:2,m:0,s:0} },
          { text: "è·Ÿè‡ªå·±è«‡åˆ¤ã€Œåªåƒä¸€å£ã€", w:{b:0,m:2,s:0} },
          { text: "å°‹æ‰¾æ›¿ä»£å„€å¼ï¼ˆå–èŒ¶/æ•£æ­¥ï¼‰", w:{b:0,m:1,s:1} },
        ]
      },
      {
        title: "ç¡çœ èˆ‡ä½œæ¯çš„ç©©å®šåº¦ï¼Ÿ",
        icon: "bi-alarm",
        options: [
          { text: "å›ºå®šæ™‚æ®µä¸ŠåºŠèµ·åºŠ", w:{b:2,m:0,s:0} },
          { text: "çœ‹å·¥ä½œ/å¿ƒæƒ…è®ŠåŒ–", w:{b:0,m:1,s:1} },
          { text: "æ™‚å¸¸å ±å¾©æ€§ç†¬å¤œ",   w:{b:0,m:2,s:0} },
        ]
      },
      {
        title: "é¢å°æŒ«æŠ˜æ™‚ä½ æœ€éœ€è¦çš„æ˜¯ï¼Ÿ",
        icon: "bi-heart",
        options: [
          { text: "æ˜ç¢ºçš„ä¸‹ä¸€æ­¥è¡Œå‹•æ¸…å–®", w:{b:1,m:1,s:0} },
          { text: "æƒ…ç·’è¢«ç†è§£èˆ‡å®‰æ”¾",     w:{b:0,m:2,s:0} },
          { text: "é‡æ–°é€£å›å…§åœ¨å‹•æ©Ÿ",     w:{b:0,m:0,s:2} },
        ]
      },
      {
        title: "å“ªä¸€ç¨®æé†’ä½ æœ€è²·å–®ï¼Ÿ",
        icon: "bi-bell",
        options: [
          { text: "æ•¸æ“šå°å‘ï¼ˆæ­¥æ•¸/å¡è·¯é‡Œï¼‰", w:{b:2,m:0,s:0} },
          { text: "æš–å¿ƒé¼“å‹µï¼ˆå¤¥ä¼´/æ•™ç·´ï¼‰",   w:{b:0,m:2,s:0} },
          { text: "éœå¿ƒèªéŒ„/é¡˜æ™¯æ¿",         w:{b:0,m:0,s:2} },
        ]
      },
      {
        title: "æƒ³å»ºç«‹å“ªå€‹æ–°ç¿’æ…£ï¼Ÿ",
        icon: "bi-stars",
        options: [
          { text: "é¤å‰å–æ°´èˆ‡è”¬èœå…ˆè¡Œ", w:{b:2,m:0,s:0} },
          { text: "å¯«ä¸‰ä»¶æ„Ÿæ©å°äº‹",     w:{b:0,m:1,s:1} },
          { text: "æ¯æ—¥ 10 åˆ†é˜å‘¼å¸è¦ºå¯Ÿ", w:{b:0,m:0,s:2} },
        ]
      },
      {
        title: "ä½ çš„ç†æƒ³æ•™ç·´é¢¨æ ¼æ˜¯ï¼Ÿ",
        icon: "bi-people",
        options: [
          { text: "ç§‘å­¸æ´¾ï¼šè¨ˆç•«èˆ‡è¿½è¹¤", w:{b:2,m:0,s:0} },
          { text: "é™ªä¼´æ´¾ï¼šæƒ…ç·’åŒåœ¨",   w:{b:0,m:2,s:0} },
          { text: "éˆæ„Ÿæ´¾ï¼šé¡˜æ™¯èˆ‡å„€å¼", w:{b:0,m:0,s:2} },
        ]
      }
    ];

    // å»ºç«‹é¡Œç›® DOMï¼ˆä¸€æ¬¡ç”¢ç”Ÿå®Œï¼Œåˆ†é å‘ˆç¾ï¼‰
    const qContainer = document.getElementById('qContainer');
    QUESTIONS.forEach((q, idx) => {
      const page = document.createElement('section');
      page.className = 'page';
      page.style.display = 'none';
      page.setAttribute('data-index', idx);

      page.innerHTML = `
        <div class="q"><i class="bi ${q.icon}"></i> Q${idx+1}. ${q.title}</div>
        ${q.options.map((opt, i) => `
          <label class="opt">
            <input type="checkbox" name="q${idx}" value="${i}" />
            <div>${opt.text}</div>
          </label>
        `).join('')}
        <div class="muted">å¯è¤‡é¸ï¼Œé¸æ“‡ç¬¦åˆä½ ç¾æ³çš„ 1â€“2 é …</div>
      `;
      qContainer.appendChild(page);
    });

    // ç‹€æ…‹æ§åˆ¶
    const btnStart  = document.getElementById('btnStart');
    const btnReset  = document.getElementById('btnReset');
    const btnPrev   = document.getElementById('btnPrev');
    const btnNext   = document.getElementById('btnNext');
    const btnSubmit = document.getElementById('btnSubmit');
    const progressText = document.getElementById('progressText');
    const bar = document.getElementById('bar');
    const form = document.getElementById('quiz');
    const result = document.getElementById('result');
    const resultText = document.getElementById('resultText');
    const resultTags = document.getElementById('resultTags');

    let pageIndex = 0;
    let started = false;

    // -----------------------------
    // Web Audio APIï¼šç°¡æ˜“æç¤ºéŸ³
    // -----------------------------
    const btnSound = document.getElementById('btnSound');
    let audioEnabled = true;
    let audioCtx = null;

    function ping(freq=660, dur=0.08, type='sine', vol=0.04){
      if(!audioEnabled) return;
      if(!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      const t0 = audioCtx.currentTime;
      const o = audioCtx.createOscillator();
      const g = audioCtx.createGain();
      o.type = type;
      o.frequency.value = freq;
      g.gain.setValueAtTime(vol, t0);
      g.gain.exponentialRampToValueAtTime(0.0001, t0 + dur);
      o.connect(g).connect(audioCtx.destination);
      o.start(t0); o.stop(t0 + dur);
    }
    function chordOK(){
      // å®ŒæˆéŸ³ï¼šå’Œå¼¦å°è·³
      setTimeout(()=>ping(523, .06, 'triangle', 0.05), 10);
      setTimeout(()=>ping(659, .06, 'triangle', 0.05), 70);
      setTimeout(()=>ping(783, .08, 'triangle', 0.05), 140);
    }

    btnSound.addEventListener('click', () => {
      audioEnabled = !audioEnabled;
      btnSound.setAttribute('aria-pressed', String(audioEnabled));
      btnSound.innerHTML = audioEnabled
        ? '<i class="bi bi-volume-up"></i> éŸ³æ•ˆï¼šé–‹'
        : '<i class="bi bi-volume-mute"></i> éŸ³æ•ˆï¼šé—œ';
      ping(480, .05, 'square', 0.03);
    });

    // -----------------------------
    // åˆ†é æ§åˆ¶èˆ‡é€²åº¦æ¢
    // -----------------------------
    function showPage(i){
      document.querySelectorAll('.page').forEach(p => p.style.display = 'none');
      const target = document.querySelector(`.page[data-index="${i}"]`);
      if(target) target.style.display = '';
      pageIndex = i;

      // æŒ‰éˆ•ç‹€æ…‹
      btnPrev.disabled = (i === 0);
      btnNext.disabled = !hasAnyChecked(i);
      btnSubmit.disabled = (i !== QUESTIONS.length - 1) || !hasAnyChecked(i);

      // é€²åº¦
      const percent = Math.round((i) / QUESTIONS.length * 100);
      bar.style.width = `${percent}%`;
      progressText.textContent = `ç¬¬ ${i+1} / ${QUESTIONS.length} é¡Œ`;
    }

    function hasAnyChecked(i){
      return !!document.querySelector(`input[name="q${i}"]:checked`);
    }

    function updateNextState(){
      if(!started) return;
      btnNext.disabled = !hasAnyChecked(pageIndex);
      btnSubmit.disabled = (pageIndex !== QUESTIONS.length - 1) || !hasAnyChecked(pageIndex);
    }

    // ç›£è½æ‰€æœ‰ checkbox ä»¥æ›´æ–°ä¸‹ä¸€æ­¥ç‹€æ…‹
    form.addEventListener('change', (e)=>{
      if(e.target && e.target.matches('input[type="checkbox"]')){
        // é™åˆ¶æœ€å¤šå‹¾ 2 å€‹ï¼ˆå¯èª¿æ•´ï¼‰
        const name = e.target.name;
        const checked = Array.from(document.querySelectorAll(`input[name="${name}"]:checked`));
        if(checked.length > 2){
          e.target.checked = false;
          ping(220, .06, 'square', 0.04); // è¼•å¾®è­¦ç¤º
          return;
        }
        updateNextState();
        ping(700, .03, 'sine', 0.025);
      }
    });

    // é–‹å§‹ã€å°èˆªã€é‡è¨­
    btnStart.addEventListener('click', ()=>{
      started = true;
      btnStart.disabled = true;
      btnReset.disabled = false;
      showPage(0);
      chordOK();
    });

    btnPrev.addEventListener('click', ()=>{
      if(pageIndex>0){ showPage(pageIndex-1); ping(500,.03); }
    });
    btnNext.addEventListener('click', ()=>{
      if(pageIndex<QUESTIONS.length-1){ showPage(pageIndex+1); ping(720,.03); }
    });

    btnReset.addEventListener('click', ()=>{
      // æ¸…ç©ºä½œç­”
      form.reset();
      document.querySelectorAll('.page').forEach(p=>p.style.display='none');
      pageIndex = 0; started = false;
      btnStart.disabled = false;
      btnReset.disabled = true;
      btnPrev.disabled = true;
      btnNext.disabled = true;
      btnSubmit.disabled = true;
      bar.style.width = '0%';
      progressText.textContent = 'å°šæœªé–‹å§‹';
      result.style.display = 'none';
      ping(320,.05,'sawtooth',0.03);
    });

    // åˆå§‹ï¼šå°šæœªé–‹å§‹ï¼Œéš±è—é¡Œé 
    document.querySelectorAll('.page').forEach(p=>p.style.display='none');

    // æäº¤è¨ˆåˆ†
    form.addEventListener('submit',(e)=>{
      e.preventDefault();
      // ç´¯è¨ˆåŠ æ¬Š
      const score = { b:0, m:0, s:0 }; // body / mind / spirit
      QUESTIONS.forEach((q, i)=>{
        const checks = Array.from(document.querySelectorAll(`input[name="q${i}"]:checked`));
        checks.forEach(c=>{
          const idx = Number(c.value);
          const w = q.options[idx].w;
          score.b += w.b; score.m += w.m; score.s += w.s;
        });
      });

      // åˆ¤æ–·æœ€é«˜é¢å‘
      const entries = Object.entries(score); // [['b',..],['m',..],['s',..]]
      entries.sort((a,b)=>b[1]-a[1]);
      const [topKey, topVal] = entries[0];
      const total = score.b + score.m + score.s;

      // ç”¢ç”Ÿæ¨™ç±¤
      resultTags.innerHTML = `
        <span class="tag"><i class="bi bi-lightning"></i> èº«ï¼š${score.b}</span>
        <span class="tag"><i class="bi bi-emoji-heart-eyes"></i> å¿ƒï¼š${score.m}</span>
        <span class="tag"><i class="bi bi-moon"></i> éˆï¼š${score.s}</span>
        <span class="tag"><i class="bi bi-bar-chart"></i> ç¸½å’Œï¼š${total}</span>
      `;

      // ä¾å‚¾å‘æä¾›å»ºè­°
      const advice = {
        b: {
          title: "èº«é«”é¢å‘åé«˜",
          text: "ä½ å°æ–¼ä½œæ¯ã€ç‡Ÿé¤Šèˆ‡é‹å‹•çš„è¦å¾‹åº¦ç›¸å°åˆ°ä½ï¼å¯å˜—è©¦ã€Œé€±æœŸåŒ–è¨“ç·´ã€èˆ‡ã€Œè›‹ç™½è³ªå®šé¡ã€ï¼›è‹¥é‡åœæ»¯ï¼Œå¯ç”¨ NEATï¼ˆéé‹å‹•æ€§æ´»å‹•ï¼‰èˆ‡ç¡çœ å“è³ªå„ªåŒ–ç ´ plateauã€‚"
        },
        m: {
          title: "å¿ƒç†é¢å‘åé«˜",
          text: "ä½ å°è‡ªæˆ‘å°è©±/å£“åŠ›èª¿ç¯€å¾ˆæ•æ„Ÿã€‚å»ºè­°è¨­è¨ˆå¾®å°ä½†å¯æŒçºŒçš„çå‹µè¿´è·¯ï¼ˆä¾‹å¦‚å®Œæˆæ¸…å–®ï¼‹è²¼ç´™å›é¥‹ï¼‰ï¼Œä¸¦å»ºç«‹è§¸ç™¼â€”è¡Œå‹•â€”çè³çš„ã€æƒ…ç·’æ›¿ä»£æ–¹æ¡ˆã€ã€‚"
        },
        s: {
          title: "éˆæ€§é¢å‘åé«˜",
          text: "ä½ çš„å‹•æ©Ÿä¾†è‡ªé¡˜æ™¯èˆ‡åƒ¹å€¼æ„Ÿã€‚æ¯æ—¥ 10 åˆ†é˜å‘¼å¸è¦ºå¯Ÿã€å¯«ä¸‹ä»Šå¤©çš„ã€å°é½Šè¡Œå‹•ã€1 ä»¶äº‹ï¼›ç”¨å„€å¼åŒ–ï¼ˆéŸ³æ¨‚/é¦™æ°›/èªéŒ„ï¼‰æŠŠç·´ç¿’åµŒå…¥ç”Ÿæ´»ç¯€å¥ã€‚"
        }
      };

      const mapName = { b:"èº«", m:"å¿ƒ", s:"éˆ" };

      resultText.innerHTML = `
        <strong>${advice[topKey].title}</strong>ï¼ˆæœ€é«˜åˆ†ï¼š${mapName[topKey]}ï¼‰
        <br>${advice[topKey].text}
        <br><br>
        <em class="muted">æ•™ç·´æ¹˜èŠ¸å°å®åš€ï¼š</em> å¦‚æœä¸‰è€…åˆ†æ•¸æ¥è¿‘ï¼Œä»£è¡¨ä½ æ˜¯ã€Œå‡è¡¡å‹ã€ï¼Œæ­å–œä½ å¯ä»¥ç”¨ã€æ¯é€±ä¸€ä¸»é¡Œã€è¼ªæµæ‰“é»ä¸‰é¢å‘ï¼Œç¶­æŒå½ˆæ€§èˆ‡è¶£å‘³ï¼
      `;

      // é¡¯ç¤ºçµæœèˆ‡å®ŒæˆéŸ³
      result.style.display = '';
      result.focus();
      bar.style.width = '100%';
      progressText.textContent = `å®Œæˆï¼å…± ${QUESTIONS.length} é¡Œ`;
      chordOK();
    });

    // è¼¸å…¥æ³•å‰‡ï¼šé€²å…¥æ¯é æ™‚æª¢æŸ¥
    qContainer.addEventListener('click', (e)=>{
      if(e.target.matches('input[type="checkbox"]')){
        updateNextState();
      }
    });

    // åˆæ¬¡è¼‰å…¥ï¼šè®“é–‹å§‹éˆ•æ˜“æ–¼ç™¼ç¾
    window.addEventListener('load', ()=>{
      btnStart.focus();
    });
  </script>
</body>
</html>
