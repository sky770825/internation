<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ğŸ§® ç´—çª—å ±åƒ¹è¨ˆç®—å™¨ï¼ˆå–®è¡Œç²¾ç°¡ãƒ»æœ€ä½8æ‰/ä»¶ï¼‰</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
<style>
  /* è¦ç¯„å¿…è¦ï¼šé¿å…å…ƒç´ è¶…å‡ºå®¹å™¨ */
  * { box-sizing: border-box; }
  input, select, textarea { max-width: 100%; }

  /* æš–è‰²ç³»æ´»æ½‘é¢¨æ ¼ï¼ˆBootswatch-likeï¼‰
     è¨»ï¼šä¾è¦ç¯„æ‡‰éš¨æ©Ÿå¥—ç”¨ bootswatch_css.zipï¼Œä½†ç›®å‰ç’°å¢ƒç„¡æ³•ç›´æ¥è®€å–å£“ç¸®æª”ï¼Œ
     å…ˆä»¥è¿‘ä¼¼ Bootswatch çš„æš–è‰²ä¸»é¡Œï¼›è‹¥è¦ã€Œé‡æŠ½ä¸»é¡Œã€å†å‘Šè¨´æˆ‘ã€‚ */
  :root{
    --font:'Microsoft JhengHei',system-ui,-apple-system,Segoe UI,Roboto,Noto Sans TC,Arial,sans-serif;
    --bg:#fff7ed; --card:#fff; --ink:#5b3a29; --sub:#7b5b4a;
    --brand:#ff7f50; --brand2:#ffb703; --muted:#fff0e0; --line:#f2d3b1;
    --shadow:0 8px 16px rgba(0,0,0,.08); --r:14px;
  }
  html,body{ margin:0; font-family:var(--font); background:var(--bg); color:var(--ink); }
  .wrap{ max-width:1100px; margin:auto; padding:clamp(10px,3vw,18px); }

  .hero{
    background:linear-gradient(135deg,var(--muted),#fff); border:1px solid #ffd6ad; border-radius:var(--r);
    box-shadow:var(--shadow); padding:clamp(12px,3vw,20px); margin-bottom:12px;
  }
  .hero h1{ margin:0; font-size:clamp(20px,5.2vw,30px); display:flex; align-items:center; gap:10px }
  .badge{ display:inline-block; padding:3px 10px; background:#fff0e0; border:1px solid #ffd7b0; color:#8d6e63; border-radius:999px; font-size:12px }

  .card{ background:#fff; border:1px solid var(--line); border-radius:var(--r); box-shadow:var(--shadow); padding:clamp(10px,3vw,16px); }
  .section-title{ display:flex; align-items:center; gap:8px; color:var(--brand); font-size:clamp(18px,4.5vw,22px); margin:0 0 8px; }

  .btn{
    display:inline-flex; align-items:center; gap:8px; justify-content:center; font-weight:700;
    padding:.7rem 1rem; border-radius:12px; border:0; cursor:pointer; color:#fff;
    background:linear-gradient(180deg,#ff9f68,var(--brand)); box-shadow:0 8px 14px rgba(255,127,80,.28);
    font-size:clamp(14px,4.2vw,16px);
  }
  .btn-ghost{ background:linear-gradient(180deg,#ffd166,var(--brand2)); color:#5b3a29 }

  /* â€”â€” å–®è¡Œè³‡æ–™åˆ—ï¼ˆçª„è¢å¹•ä»ç›¡é‡ç¶­æŒå–®è¡Œï¼‰ â€”â€” */
  .list{ display:grid; gap:10px; }
  .row{
    display:grid; gap:8px;
    grid-template-columns: 1.1fr .8fr 84px 84px 70px 120px 120px 110px 44px; /* å–®è¡Œ */
    align-items:center;
    background:#fff; border:1px solid #ffe0bf; border-radius:12px; padding:8px;
  }
  @media (max-width: 720px){
    .row{
      grid-template-columns: 1fr .7fr 64px 64px 60px 1fr 1fr 100px 40px;
      padding:6px;
    }
  }

  .hdr{ display:grid; gap:6px;
        grid-template-columns: 1.1fr .8fr 84px 84px 70px 120px 120px 110px 44px;
        font-size:12px; color:#7b5b4a; padding:0 4px 4px; }
  @media (max-width:720px){
    .hdr{ grid-template-columns: 1fr .7fr 64px 64px 60px 1fr 1fr 100px 40px; }
  }

  .form-control, select{
    width:100%; padding:.55rem .6rem; border:1px solid #e9caa8; border-radius:10px; background:#fff;
    font-size:clamp(13px,4vw,15px); outline:0; transition:.2s box-shadow,.2s border-color;
  }
  .form-control:focus, select:focus{ border-color:#ffc48a; box-shadow:0 0 0 3px rgba(255,159,104,.23) }
  .num{ text-align:right; }
  .num::-webkit-outer-spin-button,.num::-webkit-inner-spin-button{ -webkit-appearance:none; margin:0; }

  /* é™½å°å·¥ç¨‹å°å‹é–‹é—œ */
  .switch{ --h:34px; display:flex; align-items:center; gap:8px; justify-self:start; }
  .switch input{ display:none }
  .slider{ width:68px; height:var(--h); background:#ffd9b3; border:1px solid #ffc48a; border-radius:999px; position:relative; transition:.2s }
  .slider::after{ content:""; position:absolute; top:4px; left:4px; width:calc(var(--h) - 8px); height:calc(var(--h) - 8px);
    background:#fff; border-radius:50%; box-shadow:0 2px 6px rgba(0,0,0,.12); transition:.2s transform; }
  .switch input:checked + .slider{ background:#ff9f68; border-color:#ff9f68 }
  .switch input:checked + .slider::after{ transform:translateX(34px) }
  .switch .lab{ font-size:12px; color:#7b5b4a; }

  .mini{ font-size:12px; color:#8d6e63; background:#fffaf5; border:1px dashed #ffd7b0; padding:3px 6px; border-radius:999px; display:inline-block; text-align:center; }
  .right{text-align:right}

  .sum{ background:#fff5eb; border:1px dashed #ffcba4; border-radius:12px; padding:10px }
  .kpi{ font-size:clamp(20px,5.5vw,26px); font-weight:900; color:#ff6f30 }

  /* å–®åƒ¹å€å°ç¶²æ ¼ */
  .price-grid{ display:grid; gap:10px; grid-template-columns: repeat(3,1fr); }
  @media (max-width:720px){ .price-grid{ grid-template-columns: 1fr 1fr; } }

  /* è¿”å›æŒ‰éˆ• */
  .back-btn{
    display:inline-flex; align-items:center; gap:6px; padding:8px 12px;
    background:var(--brand2); color:var(--ink); border-radius:8px; text-decoration:none;
    font-size:14px; font-weight:600; margin-bottom:16px;
  }
  .back-btn:hover{ background:#ffd166; transform:translateY(-1px); }
</style>
</head>
<body>
  <div class="wrap">
    <!-- è¿”å›æŒ‰éˆ• -->
    <a href="index.html" class="back-btn">
      <i class="bi bi-arrow-left"></i> è¿”å›å·¥å…·é›†
    </a>

    <!-- é é¦–ï¼ˆèªªæ˜&è¦å‰‡ï¼‰ -->
    <section class="hero">
      <h1><i class="bi bi-list-check"></i> ç´—çª—å ±åƒ¹è¨ˆç®—å™¨
        <span class="badge">æè€— +20cm</span>
        <span class="badge">é™½å°å·¥ç¨‹é–‹é—œ</span>
        <span class="badge">å–®è¡Œç²¾ç°¡</span>
        <span class="badge">æ¯ä»¶æœ€ä½ 8 æ‰</span>
      </h1>
      <div class="mini" style="margin-top:6px;">æ‰æ•¸ï¼((å¯¬+20)Ã—(é«˜+20))Ã·900Ã—æ•¸é‡ï¼›æ¯ä»¶è‹¥ &lt; 8 æ‰ï¼ŒæŒ‰ 8 æ‰è¨ˆã€‚</div>
    </section>

    <!-- åˆ—è¡¨ -->
    <section class="card">
      <h2 class="section-title"><i class="bi bi-clipboard2"></i> å ±åƒ¹å“é …</h2>

      <div class="hdr">
        <div>ä½ç½®</div><div>é¡å‹</div>
        <div class="right">å¯¬</div><div class="right">é«˜</div><div class="right">æ•¸é‡</div>
        <div>åŠ æè€—å¾Œ(å¯¬Ã—é«˜)</div><div>æ‰æ•¸(è¨ˆåƒ¹ï¼Œæœ€ä½8)</div><div>é™½å°å·¥ç¨‹</div><div></div>
      </div>

      <div id="list" class="list" aria-live="polite"></div>

      <div style="display:flex; gap:10px; margin-top:8px; flex-wrap:wrap;">
        <button id="addRow" class="btn"><i class="bi bi-plus-circle"></i> æ–°å¢ä¸€ç­†</button>
        <button id="clearRows" class="btn btn-ghost"><i class="bi bi-trash3"></i> æ¸…ç©ºåˆ—è¡¨</button>
        <button id="calc" class="btn" style="margin-left:auto;"><i class="bi bi-calculator"></i> è¨ˆç®—å ±åƒ¹</button>
      </div>
    </section>

    <!-- å–®åƒ¹èˆ‡å…¶ä»–è²»ç”¨ -->
    <section class="card" style="margin-top:12px;">
      <h2 class="section-title"><i class="bi bi-sliders"></i> å–®åƒ¹è¨­å®šèˆ‡å…¶ä»–è²»ç”¨</h2>
      <div class="price-grid">
        <div><div class="mini">ç´—ç¶²ï¼ˆå¹³ç´—ï¼‰å–®åƒ¹ï¼æ‰</div><input id="priceScreen" class="form-control num" type="number" value="405" min="0"></div>
        <div><div class="mini">æ²ç´—æ©Ÿæ§‹å–®åƒ¹ï¼æ‰</div><input id="priceRoller" class="form-control num" type="number" value="500" min="0"></div>
        <div><div class="mini">çƒ¤æ¼†å–®åƒ¹ï¼æ‰ï¼ˆæ²ç´—ï¼‰</div><input id="pricePaint" class="form-control num" type="number" value="300" min="0"></div>
        <div><div class="mini">å›ºå®šæ–½å·¥è²»ï¼ˆå…¶ä»–ï¼‰</div><input id="installFee" class="form-control num" type="number" value="0" min="0"></div>
        <div><div class="mini">å°ç‰ˆæ•¸é‡ï¼ˆæ¯ç‰ˆ 3,500ï¼‰</div><input id="boardQty" class="form-control num" type="number" value="0" min="0"></div>
        <div><div class="mini">æ´—æ´æ•¸é‡ï¼ˆæ¯æ´ 3,500ï¼‰</div><input id="holeQty" class="form-control num" type="number" value="0" min="0"></div>
        <div><div class="mini">ç‡Ÿæ¥­ç¨…ç‡ï¼ˆ%ï¼‰</div><input id="taxRate" class="form-control num" type="number" value="5" min="0"></div>
        <div><div class="mini">é™½å°å·¥ç¨‹å–®åƒ¹ï¼æ‰ï¼ˆæœ€ä½ 24,000ï¼‰</div><input id="balconyPrice" class="form-control num" type="number" value="800" min="0"></div>
      </div>

      <div class="sum" id="summary" style="margin-top:10px;">
        <div>ç¸½æ‰æ•¸ï¼š<span id="totalTsai" class="kpi">0.00</span> æ‰</div>
        <hr>
        <div>ææ–™è²»ï¼ˆå¹³ç´—ï¼‰ï¼š<span id="feeScreen" class="kpi">0</span> å…ƒ</div>
        <div>ææ–™è²»ï¼ˆæ²ç´—æ©Ÿæ§‹ï¼‰ï¼š<span id="feeRoller" class="kpi">0</span> å…ƒ</div>
        <div>çƒ¤æ¼†è²»ï¼ˆæ²ç´—ï¼‰ï¼š<span id="feePaint" class="kpi">0</span> å…ƒ</div>
        <div>é™½å°å·¥ç¨‹ï¼ˆæœ€ä½ 24,000ï¼‰ï¼š<span id="feeBalcony" class="kpi">0</span> å…ƒ</div>
        <div>å°ç‰ˆï¼š<span id="feeBoard" class="kpi">0</span> å…ƒï¼›æ´—æ´ï¼š<span id="feeHole" class="kpi">0</span> å…ƒ</div>
        <div>å·¥æœ¬è²»ï¼ˆ<span id="laborRule">æœªé” 50 æ‰ â†’ 4,500 å…ƒ</span>ï¼‰ï¼š<span id="laborFee" class="kpi">0</span> å…ƒ</div>
        <div>å…¶ä»–æ–½å·¥è²»ï¼š<span id="installFeeOut" class="kpi">0</span> å…ƒ</div>
        <hr>
        <div>å°è¨ˆï¼ˆæœªç¨…ï¼‰ï¼š<span id="subtotal" class="kpi">0</span> å…ƒã€€ã€€ç‡Ÿæ¥­ç¨…ï¼š<span id="tax" class="kpi">0</span> å…ƒ</div>
        <div style="font-weight:900; font-size:clamp(18px,5vw,22px);">ç¸½é‡‘é¡ï¼ˆå«ç¨…ï¼‰ï¼š<span id="grand" class="kpi">0</span> å…ƒ</div>
      </div>
    </section>
  </div>

<script>
/* ============================================================
   å–®è¡Œç²¾ç°¡ç‰ˆï¼ˆä¿®æ­£ï¼šæ¯ä»¶æœ€ä½ 8 æ‰ï¼›è¨ˆç®—éµç©©å¥ï¼‰
   - æ‰æ•¸ = ((å¯¬+20)*(é«˜+20))/900
   - è¨ˆåƒ¹æ‰æ•¸ = max(å–®ä»¶æ‰æ•¸, 8) Ã— æ•¸é‡
   - å·¥æœ¬è²»: ç¸½æ‰æ•¸<50 â†’ 4500ï¼›>=50 â†’ ç¸½æ‰æ•¸*90
   - æ²ç´—ï¼šæ©Ÿæ§‹(é è¨­500/æ‰) + çƒ¤æ¼†(é è¨­300/æ‰)
   - é™½å°å·¥ç¨‹ï¼šå‹¾é¸åˆ—æ‰æ•¸ Ã— å–®åƒ¹ï¼›æœ€å¾Œå¥—æœ€ä½ 24000
   - å°ç‰ˆ/æ´—æ´ï¼šå„ 3500 Ã— æ•¸é‡
============================================================ */

const list = document.getElementById('list');
const addRowBtn = document.getElementById('addRow');
const clearRowsBtn = document.getElementById('clearRows');
const calcBtn = document.getElementById('calc');

addRowBtn.addEventListener('click', ()=> addRow());
clearRowsBtn.addEventListener('click', ()=> list.innerHTML='');
calcBtn.addEventListener('click', ()=> {
  // è¨ˆç®—å‰é€åˆ—æ›´æ–°ï¼Œé¿å…èˆŠå€¼
  [...list.querySelectorAll('.row')].forEach(updateRow);
  computeAll();
});

// é è¨­ 5 ç­†ç©ºç™½
for (let i=0;i<5;i++) addRow();

function addRow(init={}){
  const row = document.createElement('div');
  row.className = 'row';
  row.innerHTML = `
    <input class="form-control place" type="text" placeholder="ä¾‹ï¼šå®¢å»³" value="${init.place??''}">
    <select class="form-control type">
      <option value="å¹³ç´—"${init.type==='å¹³ç´—'?' selected':''}>å¹³ç´—</option>
      <option value="æ²ç´—"${init.type==='æ²ç´—'?' selected':''}>æ²ç´—</option>
    </select>

    <input class="form-control num w" type="text" inputmode="numeric" pattern="[0-9]*" maxlength="3" placeholder="å¯¬" value="${init.w??''}">
    <input class="form-control num h" type="text" inputmode="numeric" pattern="[0-9]*" maxlength="3" placeholder="é«˜" value="${init.h??''}">
    <input class="form-control num qty" type="text" inputmode="numeric" pattern="[0-9]*" maxlength="3" value="${init.qty??1}">

    <div class="mini addwh">â€”</div>
    <div class="mini tsai right" title="è¨ˆåƒ¹æ‰æ•¸ï¼ˆæ¯ä»¶æœ€ä½8æ‰ï¼‰">0.00</div>

    <label class="switch" title="æ˜¯å¦è¨ˆå…¥é™½å°å·¥ç¨‹">
      <input type="checkbox" class="bal"${init.bal?' checked':''}>
      <span class="slider" aria-hidden="true"></span>
      <span class="lab">é™½å°</span>
    </label>

    <button class="btn btn-ghost del" title="åˆªé™¤"><i class="bi bi-x-lg"></i></button>
  `;
  row.querySelector('.del').addEventListener('click', ()=> row.remove());
  ['input','change','keyup'].forEach(ev=> row.addEventListener(ev, ()=> updateRow(row)));
  list.appendChild(row);
  updateRow(row); // åˆå§‹å³æ™‚è¨ˆç®—
}

/* å–®åˆ—ï¼šå³æ™‚è¨ˆç®—é¡¯ç¤ºï¼ˆå«æœ€ä½8æ‰è¦å‰‡ï¼‰ */
function updateRow(row){
  // åƒ…ä¿ç•™æ•¸å­—ï¼Œé™åˆ¶æœ€å¤š3ä½
  ['w','h','qty'].forEach(cls=>{
    const el = row.querySelector('.'+cls);
    el.value = (el.value||'').replace(/\D/g,'').slice(0,3);
  });

  const w = toNum(row.querySelector('.w').value);
  const h = toNum(row.querySelector('.h').value);
  const qty = Math.max(1, toInt(row.querySelector('.qty').value) || 1);

  const addW = w + 20, addH = h + 20;
  const tsaiOne = (addW * addH) / 900;           // å–®ä»¶åŸå§‹æ‰æ•¸
  const tsaiCharge = Math.max(tsaiOne, 8) * qty; // è¨ˆåƒ¹æ‰æ•¸ï¼ˆæœ€ä½8æ‰/ä»¶ï¼‰

  row.querySelector('.addwh').textContent = `${isFinite(addW)?addW:0} Ã— ${isFinite(addH)?addH:0}`;
  row.querySelector('.tsai').textContent = format2(tsaiCharge);
}

/* ä¸»è¨ˆç®—ï¼ˆå½™ç¸½æ‰€æœ‰åˆ—ï¼‰ */
function computeAll(){
  const rows = [...list.querySelectorAll('.row')];
  if (!rows.length){ alert('è«‹å…ˆæ–°å¢è‡³å°‘ä¸€ç­†'); return; }

  const priceScreen = toNum($('#priceScreen').value);
  const priceRoller = toNum($('#priceRoller').value);
  const pricePaint  = toNum($('#pricePaint').value);
  const balconyPrice= toNum($('#balconyPrice').value);
  const installFee  = toNum($('#installFee').value);
  const boardQty    = toInt($('#boardQty').value);
  const holeQty     = toInt($('#holeQty').value);
  const taxRate     = toNum($('#taxRate').value);

  let totalTsai=0, tsaiScreen=0, tsaiRoller=0, tsaiBalcony=0;

  rows.forEach(row=>{
    const type = row.querySelector('.type').value;
    const tsaiCharged = toNum(row.querySelector('.tsai').textContent); // å·²æ˜¯ã€Œè¨ˆåƒ¹æ‰æ•¸ï¼ˆå«æœ€ä½8æ‰ï¼‰ã€
    const isBal= row.querySelector('.bal').checked;

    totalTsai += tsaiCharged;
    if (type==='å¹³ç´—') tsaiScreen += tsaiCharged;
    if (type==='æ²ç´—') tsaiRoller += tsaiCharged;
    if (isBal) tsaiBalcony += tsaiCharged;
  });

  // ææ–™èˆ‡åŠ å·¥
  const feeScreen = tsaiScreen * priceScreen;
  const feeRoller = tsaiRoller * priceRoller;
  const feePaint  = tsaiRoller * pricePaint;

  // é™½å°å·¥ç¨‹ï¼ˆæœ€ä½ 24,000ï¼‰
  let feeBalcony = tsaiBalcony * balconyPrice;
  if (feeBalcony > 0 && feeBalcony < 24000) feeBalcony = 24000;

  // å°ç‰ˆ/æ´—æ´
  const feeBoard = Math.max(0, boardQty) * 3500;
  const feeHole  = Math.max(0, holeQty) * 3500;

  // å·¥æœ¬è²»
  let laborFee=0, ruleText='';
  if (totalTsai < 50){ laborFee=4500; ruleText='æœªé” 50 æ‰ â†’ å›ºå®š 4,500 å…ƒ'; }
  else { laborFee = totalTsai * 90; ruleText='â‰§ 50 æ‰ â†’ 90 å…ƒ/æ‰'; }

  const subtotal = feeScreen + feeRoller + feePaint + feeBalcony + feeBoard + feeHole + laborFee + installFee;
  const tax = subtotal * (taxRate/100);
  const grand = subtotal + tax;

  // è¼¸å‡º
  setText('totalTsai', format2(totalTsai));
  setText('feeScreen', money(feeScreen));
  setText('feeRoller', money(feeRoller));
  setText('feePaint',  money(feePaint));
  setText('feeBalcony',money(feeBalcony));
  setText('feeBoard',  money(feeBoard));
  setText('feeHole',   money(feeHole));
  setText('laborRule', ruleText);
  setText('laborFee',  money(laborFee));
  setText('installFeeOut', money(installFee));
  setText('subtotal',  money(subtotal));
  setText('tax',       money(tax));
  setText('grand',     money(grand));
}

/* å·¥å…·ï¼šç©©å¥çš„æ•¸å€¼è™•ç†ï¼Œé¿å… NaN å°è‡´ã€Œæ²’åæ‡‰ã€ */
function $(id){ return document.getElementById(id); }
function toNum(v){
  if (v === null || v === undefined) return 0;
  const n = parseFloat(String(v).replace(/[^\d.\-]/g,''));
  return Number.isFinite(n) ? n : 0;
}
function toInt(v){
  if (v === null || v === undefined) return 0;
  const n = parseInt(String(v).replace(/[^\d\-]/g,''),10);
  return Number.isFinite(n) ? n : 0;
}
function format2(n){ return (Math.round(n*100)/100).toFixed(2); }
function money(n){ return Math.round(n).toLocaleString('zh-Hant-TW'); }
function setText(id,txt){ document.getElementById(id).textContent = txt; }
</script>
</body>
</html>
